# ADR-002: Resources Integration Pattern

**Status**: MANDATORY  
**Date**: 2024-01-01  
**Decision Makers**: Framework Team

## Context

Resources integration has been problematic due to:
- Trait implementation conflicts between derive macros and blanket implementations
- Missing required trait imports causing method resolution failures
- Framework version mismatches creating incompatible trait definitions
- Unclear error handling patterns for resource operations

## Decision

MCP Resources MUST be implemented using the framework's trait-based pattern with proper import discipline and derive macro usage.

## Implementation

### ✅ CORRECT Resource Implementation Pattern
```rust
// Protocol types
use turul_mcp_protocol::{ResourceContent, McpResult, McpError};

// Framework traits
use turul_mcp_builders::prelude::*;  // HasResourceMetadata, ResourceDefinition, etc.

// Derive macro
use turul_mcp_derive::McpResource;
use serde::{Serialize, Deserialize};

#[derive(McpResource, Clone, Serialize, Deserialize)]
#[resource(
    name = "ticker_announcements",
    description = "ASX ticker announcements and market data"
)]
pub struct TickerAnnouncementsResource {
    pub ticker: String,
    pub date_range: Option<String>,
}

impl TickerAnnouncementsResource {
    // Business logic methods here
    pub async fn fetch_announcements(&self) -> McpResult<Vec<Announcement>> {
        // Implementation
    }
}
```

### Required Import Pattern
```rust
// MANDATORY: Protocol types from protocol crate
use turul_mcp_protocol::{
    Resource,           // Protocol type for resource metadata
    ResourceContent,    // Protocol type for resource content
    McpResult,         // Result type alias
    McpError,          // Error type
};

// MANDATORY: Framework traits from builders crate
use turul_mcp_builders::prelude::*;  // Includes:
    // - HasResourceMetadata (name, title)
    // - HasResourceUri (uri)
    // - HasResourceDescription (description)
    // - ResourceDefinition (composed trait)
    // - And all other framework traits
```

### Error Handling Pattern
```rust
use turul_mcp_protocol::McpError;

// McpResource trait is generated by #[derive(McpResource)]
// The read() method implementation is auto-generated by the macro

// Available error constructors:
// - McpError::internal_error(msg)
// - McpError::invalid_params(msg) 
// - McpError::method_not_found(method)
// - McpError::invalid_request(msg)
```

## ❌ WRONG Approaches - DO NOT USE
```rust
// ❌ Framework traits from protocol crate (no longer exist there)
use turul_mcp_protocol::{HasResourceMetadata, ResourceDefinition};

// ❌ Direct protocol version imports (bypasses alias)
use turul_mcp_protocol_2025_06_18::Resource;

// ❌ Missing builders prelude (missing framework traits)
use turul_mcp_derive::McpResource;  // Needs builders prelude for traits
```

## Consequences

- **Positive**: Eliminates trait conflicts and import issues
- **Positive**: Consistent error handling across all resources
- **Positive**: Framework auto-determines resource URIs and methods
- **Risk**: Must maintain strict import discipline across all resource implementations